import React, { useRef, useState, useEffect } from "react";
import WaveSurfer from "wavesurfer.js";
import { FaPlay, FaPause } from "react-icons/fa";

const AudioPlayer = ({ audioUrl }) => {
  const waveformRef = useRef(null);
  const waveSurferRef = useRef(null);
  const [isPlaying, setIsPlaying] = useState(false);
  const [error, setError] = useState(false); // State to track loading errors

  useEffect(() => {
    // Initialize Wavesurfer
    waveSurferRef.current = WaveSurfer.create({
      container: waveformRef.current,
      waveColor: "transparent", // Remove default wave color
      progressColor: "transparent", // Remove progress color
      height: 40,
      cursorWidth: 0,
      barWidth: 2,
      interact: true, // Disable interaction if needed
    });

    // Load the audio file
    waveSurferRef?.current?.load(audioUrl);

    // Error handling: if the audio fails to load, display an error
    waveSurferRef.current.on("error", (e) => {
      console.error("Audio loading error:", e);
      setError(true); // Set error state to true if there's a loading issue
    });

    // Custom rendering logic: replace the default with your custom icon/graphic
    waveSurferRef.current.on("ready", () => {
      // Your custom waveform rendering logic here
      // Example: Draw your custom SVG or image on the canvas element
      const canvas = waveformRef.current.querySelector("canvas");
      if (canvas) {
        // You can draw custom graphics directly on the canvas
        const ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // Custom SVG or image rendering here (simplified example)
        ctx.fillStyle = "#f04e23"; // Custom color or pattern
        ctx.fillRect(0, 0, canvas.width, canvas.height); // Example: Just a filled rectangle
      }
    });

    // Cleanup on component unmount
    return () => {
      waveSurferRef.current.destroy();
      waveSurferRef.current = null;
    };
  }, [audioUrl]);

  const handlePlayPause = () => {
    if (waveSurferRef.current.isPlaying()) {
      waveSurferRef.current.pause();
      setIsPlaying(false);
    } else {
      waveSurferRef.current.play();
      setIsPlaying(true);
    }
  };

  if (error) {
    return <div>Failed to load audio. Please try again.</div>;
  }

  return (
    <div className="d-flex gap-3 align-items-center">
      <div className="hideDefaultIcon" ref={waveformRef} style={{ marginBottom: "5px", width: "100%" }}>
        <svg
          width="68"
          height="25"
          viewBox="0 0 68 25"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M58.2305 13.5472C58.4819 13.5412 58.7213 13.4381 58.8991 13.2596C59.0769 13.081 59.1795 12.8405 59.1855 12.588V11.9475C59.1855 11.6931 59.0849 11.4491 58.9058 11.2692C58.7267 11.0893 58.4838 10.9883 58.2305 10.9883C57.9771 10.9883 57.7342 11.0893 57.5551 11.2692C57.376 11.4491 57.2754 11.6931 57.2754 11.9475V12.588C57.2814 12.8405 57.384 13.081 57.5618 13.2596C57.7396 13.4381 57.979 13.5412 58.2305 13.5472Z"
            fill="#FF7426"
          />
          <path
            d="M62.5039 13.5472C62.7553 13.5412 62.9947 13.4381 63.1725 13.2596C63.3504 13.081 63.4529 12.8405 63.459 12.588V11.9475C63.459 11.6931 63.3584 11.4491 63.1792 11.2692C63.0001 11.0893 62.7572 10.9883 62.5039 10.9883C62.2506 10.9883 62.0077 11.0893 61.8285 11.2692C61.6494 11.4491 61.5488 11.6931 61.5488 11.9475V12.588C61.5548 12.8405 61.6574 13.081 61.8352 13.2596C62.0131 13.4381 62.2525 13.5412 62.5039 13.5472Z"
            fill="#FF7426"
          />
          <path
            d="M66.4492 13.5472C66.7006 13.5412 66.94 13.4381 67.1179 13.2596C67.2957 13.081 67.3982 12.8405 67.4043 12.588V11.9475C67.4043 11.6931 67.3037 11.4491 67.1246 11.2692C66.9454 11.0893 66.7025 10.9883 66.4492 10.9883C66.1959 10.9883 65.953 11.0893 65.7738 11.2692C65.5947 11.4491 65.4941 11.6931 65.4941 11.9475V12.588C65.5002 12.8405 65.6027 13.081 65.7805 13.2596C65.9584 13.4381 66.1978 13.5412 66.4492 13.5472Z"
            fill="#FF7426"
          />
          <path
            d="M54.4083 13.2276C54.6613 13.2112 54.9043 13.1224 55.1086 12.9717L55.2367 12.8445C55.2605 12.8191 55.2784 12.7888 55.2892 12.7557C55.3 12.7226 55.3035 12.6875 55.2993 12.6529C55.2993 12.5886 55.3634 12.5242 55.3634 12.4599V12.0813C55.3678 12.0466 55.3643 12.0113 55.3532 11.9781C55.3421 11.9449 55.3237 11.9147 55.2993 11.8897C55.2993 11.8254 55.2367 11.761 55.2367 11.6967C55.1727 11.6338 55.1727 11.5695 55.1086 11.5695C54.9942 11.453 54.8517 11.3683 54.6951 11.3234C54.5385 11.2786 54.3729 11.2752 54.2146 11.3136C54.1798 11.3093 54.1445 11.3128 54.1112 11.3239C54.078 11.3351 54.0476 11.3535 54.0224 11.3779C53.9598 11.3779 53.8957 11.4408 53.8317 11.4408C53.7986 11.4432 53.7676 11.4576 53.7443 11.4813C53.721 11.505 53.7071 11.5363 53.705 11.5695L53.5769 11.6967C53.5769 11.761 53.5128 11.8254 53.5128 11.8897C53.5128 11.9541 53.4502 12.0169 53.4502 12.0813V12.4644C53.4459 12.4992 53.4493 12.5345 53.4601 12.5679C53.4709 12.6012 53.4889 12.6318 53.5128 12.6574C53.5128 12.7203 53.5769 12.7846 53.5769 12.849L53.705 12.9762C53.9107 13.1258 54.1547 13.213 54.4083 13.2276Z"
            fill="#FF7426"
          />
          <path
            d="M50.5879 17.7052C50.8393 17.6991 51.0787 17.5961 51.2565 17.4175C51.4344 17.2389 51.5369 16.9984 51.543 16.7459V7.78806C51.5332 7.54001 51.4282 7.30539 51.2501 7.13335C51.0719 6.96132 50.8343 6.86523 50.5871 6.86523C50.34 6.86523 50.1024 6.96132 49.9242 7.13335C49.746 7.30539 49.641 7.54001 49.6313 7.78806V16.7459C49.6377 16.9986 49.7406 17.239 49.9187 17.4176C50.0967 17.5961 50.3363 17.6991 50.5879 17.7052Z"
            fill="#FF7426"
          />
          <path
            d="M42.9414 20.9094C43.1928 20.9033 43.4322 20.8003 43.61 20.6217C43.7879 20.4432 43.8904 20.2027 43.8965 19.9502V4.59791C43.8965 4.3435 43.7959 4.09952 43.6167 3.91963C43.4376 3.73974 43.1947 3.63867 42.9414 3.63867C42.6881 3.63867 42.4451 3.73974 42.266 3.91963C42.0869 4.09952 41.9863 4.3435 41.9863 4.59791V19.9457C41.9912 20.199 42.0933 20.4406 42.2712 20.6201C42.4492 20.7997 42.6892 20.9033 42.9414 20.9094Z"
            fill="#FF7426"
          />
          <path
            d="M46.7641 24.105C47.0158 24.0985 47.2554 23.9953 47.4334 23.8165C47.6114 23.6377 47.7143 23.397 47.7207 23.1442V1.39158C47.711 1.14353 47.606 0.908904 47.4278 0.73687C47.2496 0.564837 47.012 0.46875 46.7649 0.46875C46.5177 0.46875 46.2801 0.564837 46.1019 0.73687C45.9237 0.908904 45.8188 1.14353 45.809 1.39158V23.1442C45.8151 23.3969 45.9176 23.6375 46.0954 23.8164C46.2731 23.9952 46.5126 24.0985 46.7641 24.105Z"
            fill="#FF7426"
          />
          <path
            d="M39.1211 17.0663C39.3726 17.0598 39.6121 16.9565 39.7898 16.7777C39.9676 16.5988 40.0701 16.3582 40.0762 16.1056V8.42868C40.0664 8.18064 39.9615 7.94601 39.7833 7.77398C39.6051 7.60195 39.3675 7.50586 39.1203 7.50586C38.8732 7.50586 38.6356 7.60195 38.4574 7.77398C38.2792 7.94601 38.1742 8.18064 38.1645 8.42868V16.1056C38.1709 16.3583 38.2737 16.599 38.4518 16.7778C38.6298 16.9566 38.8694 17.0599 39.1211 17.0663Z"
            fill="#FF7426"
          />
          <path
            d="M35.2988 14.8276C35.5502 14.8215 35.7896 14.7185 35.9675 14.5399C36.1453 14.3613 36.2479 14.1209 36.2539 13.8684V10.6689C36.2442 10.4209 36.1392 10.1862 35.961 10.0142C35.7828 9.84218 35.5452 9.74609 35.2981 9.74609C35.0509 9.74609 34.8133 9.84218 34.6351 10.0142C34.4569 10.1862 34.352 10.4209 34.3422 10.6689V13.8684C34.3483 14.1211 34.4511 14.3618 34.6292 14.5404C34.8073 14.7191 35.0471 14.8219 35.2988 14.8276Z"
            fill="#FF7426"
          />
          <path
            d="M31.4743 15.4681C31.7259 15.462 31.9655 15.359 32.1435 15.1805C32.3216 15.0019 32.4245 14.7615 32.4309 14.5088V10.0299C32.436 9.90064 32.415 9.77168 32.3693 9.65076C32.3235 9.52984 32.2539 9.41944 32.1647 9.32618C32.0754 9.23293 31.9683 9.15873 31.8498 9.10805C31.7313 9.05737 31.6039 9.03125 31.4751 9.03125C31.3463 9.03125 31.2188 9.05737 31.1003 9.10805C30.9818 9.15873 30.8747 9.23293 30.7854 9.32618C30.6962 9.41944 30.6266 9.52984 30.5808 9.65076C30.5351 9.77168 30.5141 9.90064 30.5192 10.0299V14.5088C30.5253 14.7613 30.6278 15.0018 30.8057 15.1804C30.9835 15.359 31.2229 15.462 31.4743 15.4681Z"
            fill="#FF7426"
          />
          <path
            d="M27.6601 16.4208C27.9115 16.4147 28.151 16.3117 28.3288 16.1331C28.5066 15.9545 28.6092 15.714 28.6152 15.4615V9.06861C28.6152 8.94264 28.5905 8.81791 28.5425 8.70153C28.4945 8.58515 28.4242 8.4794 28.3355 8.39033C28.2468 8.30125 28.1415 8.2306 28.0256 8.18239C27.9098 8.13419 27.7856 8.10938 27.6601 8.10938C27.5347 8.10938 27.4105 8.13419 27.2946 8.18239C27.1788 8.2306 27.0735 8.30125 26.9848 8.39033C26.8961 8.4794 26.8257 8.58515 26.7777 8.70153C26.7297 8.81791 26.705 8.94264 26.705 9.06861V15.4675C26.7126 15.719 26.8158 15.9579 26.9935 16.1352C27.1712 16.3126 27.4097 16.4148 27.6601 16.4208Z"
            fill="#FF7426"
          />
          <path
            d="M23.832 14.5089C24.0836 14.5025 24.323 14.3991 24.5008 14.2203C24.6786 14.0415 24.7811 13.8008 24.7871 13.5482V10.9892C24.7774 10.7412 24.6724 10.5066 24.4942 10.3345C24.316 10.1625 24.0784 10.0664 23.8313 10.0664C23.5841 10.0664 23.3465 10.1625 23.1683 10.3345C22.9902 10.5066 22.8852 10.7412 22.8754 10.9892V13.5482C22.8818 13.801 22.9847 14.0416 23.1627 14.2204C23.3407 14.3992 23.5803 14.5025 23.832 14.5089Z"
            fill="#FF7426"
          />
          <path
            d="M20.0083 14.1887C20.2602 14.183 20.5002 14.08 20.6784 13.901C20.8565 13.7221 20.9592 13.481 20.9648 13.228V11.3095C20.9551 11.0615 20.8501 10.8269 20.6719 10.6548C20.4937 10.4828 20.2562 10.3867 20.009 10.3867C19.7618 10.3867 19.5243 10.4828 19.3461 10.6548C19.1679 10.8269 19.0629 11.0615 19.0532 11.3095V13.228C19.0588 13.4808 19.1612 13.7216 19.3391 13.9005C19.517 14.0794 19.7566 14.1827 20.0083 14.1887Z"
            fill="#FF7426"
          />
          <path
            d="M16.186 13.227H16.3767C16.4114 13.2313 16.4466 13.2279 16.4798 13.217C16.513 13.2062 16.5434 13.1881 16.5689 13.1641C16.6315 13.1641 16.6956 13.0998 16.7596 13.0998C16.8237 13.0354 16.8863 13.0354 16.8863 12.9711L17.0144 12.8439C17.0144 12.7795 17.0785 12.7152 17.0785 12.6523C17.0785 12.5895 17.1426 12.5236 17.1426 12.4593V12.2677C17.1257 12.0135 17.0368 11.7695 16.8863 11.5644L16.7596 11.4357C16.7344 11.4118 16.7042 11.3938 16.6712 11.383C16.6383 11.3721 16.6034 11.3687 16.5689 11.3728C16.5049 11.3728 16.4408 11.3085 16.3767 11.3085H15.9953C15.9607 11.3041 15.9256 11.3076 15.8926 11.3187C15.8595 11.3299 15.8294 11.3484 15.8045 11.3728C15.7405 11.3728 15.6764 11.4357 15.6123 11.4357C15.5793 11.4382 15.5483 11.4526 15.525 11.4762C15.5017 11.4999 15.4878 11.5312 15.4857 11.5644C15.3986 11.6586 15.3312 11.7694 15.2874 11.8902C15.2436 12.011 15.2244 12.1393 15.2309 12.2677V12.4593C15.2266 12.4942 15.2301 12.5297 15.2412 12.5631C15.2523 12.5965 15.2706 12.627 15.295 12.6523C15.295 12.7152 15.3575 12.7795 15.3575 12.8439L15.4857 12.9711L15.6123 13.0998C15.6764 13.0998 15.7405 13.1641 15.8045 13.1641C15.8686 13.1641 15.9312 13.227 15.9953 13.227H16.186Z"
            fill="#FF7426"
          />
          <path
            d="M12.3633 13.5472C12.6147 13.5412 12.8541 13.4381 13.0319 13.2596C13.2097 13.081 13.3123 12.8405 13.3184 12.588V11.9475C13.3184 11.6931 13.2177 11.4491 13.0386 11.2692C12.8595 11.0893 12.6166 10.9883 12.3633 10.9883C12.11 10.9883 11.867 11.0893 11.6879 11.2692C11.5088 11.4491 11.4082 11.6931 11.4082 11.9475V12.588C11.4142 12.8405 11.5168 13.081 11.6946 13.2596C11.8724 13.4381 12.1119 13.5412 12.3633 13.5472Z"
            fill="#FF7426"
          />
          <path
            d="M4.71334 13.5479C4.96489 13.5419 5.20448 13.4389 5.38254 13.2604C5.5606 13.0818 5.66349 12.8413 5.66992 12.5887V11.9482C5.66017 11.7002 5.5552 11.4655 5.37701 11.2935C5.19883 11.1215 4.96125 11.0254 4.71409 11.0254C4.46692 11.0254 4.22935 11.1215 4.05116 11.2935C3.87297 11.4655 3.76801 11.7002 3.75825 11.9482V12.5887C3.7643 12.8412 3.86687 13.0817 4.04469 13.2603C4.22251 13.4388 4.46194 13.5419 4.71334 13.5479Z"
            fill="#FF7426"
          />
          <path
            d="M8.54296 13.2268C8.79593 13.2104 9.03894 13.1216 9.24326 12.9709L9.36991 12.8437C9.36991 12.7794 9.43398 12.715 9.43398 12.6522C9.43398 12.5893 9.49805 12.5235 9.49805 12.4591V12.2676C9.48099 12.0137 9.39265 11.7698 9.24326 11.5642C9.17919 11.4999 9.11511 11.4999 9.11511 11.4355C9.08996 11.4115 9.0598 11.3934 9.02681 11.3825C8.99382 11.3717 8.95884 11.3683 8.9244 11.3727C8.86033 11.3727 8.79774 11.3083 8.73367 11.3083H8.35074C8.31619 11.3041 8.28114 11.3077 8.24815 11.3189C8.21515 11.33 8.18505 11.3484 8.16002 11.3727C8.09595 11.3727 8.03337 11.4355 7.9693 11.4355C7.93601 11.4377 7.90463 11.4519 7.88104 11.4756C7.85745 11.4993 7.84327 11.5308 7.84116 11.5642C7.75407 11.6584 7.68665 11.7692 7.64289 11.89C7.59913 12.0108 7.57991 12.1392 7.58638 12.2676V12.4591C7.58207 12.4941 7.58559 12.5295 7.59667 12.5629C7.60775 12.5963 7.62613 12.6268 7.65044 12.6522C7.65044 12.715 7.71451 12.7794 7.71451 12.8437L7.84265 12.9784L7.97079 13.1071C8.03486 13.1071 8.09745 13.1714 8.16152 13.1714C8.22559 13.1714 8.28965 13.2343 8.35223 13.2343L8.54296 13.2268Z"
            fill="#FF7426"
          />
          <path
            d="M0.896474 13.2265C1.14945 13.2101 1.39246 13.1213 1.59678 12.9706L1.72492 12.8434C1.73163 12.7946 1.75415 12.7494 1.78898 12.7147C1.78898 12.6519 1.85156 12.5875 1.85156 12.5232V12.3316C1.83523 12.0776 1.74683 11.8335 1.59678 11.6283C1.21534 11.2437 0.577615 11.2437 0.255774 11.6283C0.168397 11.7223 0.100789 11.833 0.0570102 11.9539C0.0132312 12.0747 -0.0058223 12.2032 0.000980377 12.3316V12.5292C-0.00339496 12.5638 -4.93526e-05 12.5989 0.0107749 12.632C0.0215991 12.6652 0.0396278 12.6954 0.063558 12.7207C0.0702754 12.7695 0.0927882 12.8147 0.127627 12.8494C0.191697 12.9138 0.191704 12.9766 0.255774 12.9766C0.43159 13.136 0.659615 13.225 0.896474 13.2265Z"
            fill="#FF7426"
          />
        </svg>
      </div>
      <button
        onClick={handlePlayPause}
        style={{ background: "none", border: "none", outline: "none", boxShadow: "none" }}
      >
        {/* Play/Pause Button */}
        {isPlaying ? (
          <svg
            width="34"
            height="34"
            viewBox="0 0 34 34"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle cx="16.8326" cy="16.6626" r="16.5708" fill="white" />
            <rect x="13" y="12" width="2" height="10" rx="1" fill="#FF7426" />
            <rect x="18" y="12" width="2" height="10" rx="1" fill="#FF7426" />
          </svg>
        ) : (
          <svg
            width="34"
            height="34"
            viewBox="0 0 34 34"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle cx="16.8326" cy="16.6626" r="16.5708" fill="white" />
            <path
              d="M21.9023 16.131L13.1189 21.2021L13.1189 11.0599L21.9023 16.131Z"
              fill="#FF7426"
            />
          </svg>
        )}
      </button>
    </div>
  );
};

export default AudioPlayer;
